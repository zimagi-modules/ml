data:
  training_event:
    class: TrainingEvent
    id_fields: [timestamp, definition_id]
    key: event
    roles:
      edit: [scheduler]
      view: [scheduler, predicter]
    fields:
      timestamp:
        type: "@django.DateTimeField"
        options:
          "null": false
          editable: false
      definition_id:
        type: "@django.UUIDField"
        options:
          "null": false
          editable: false
      resources_group:
        type: "@django.UUIDField"
        options:
          "null": true
          editable: true
      data_source:
        type: "@django.TextField"
        options:
          "null": false
          editable: false
      # A plausible use case is simply not to store the training model BLOB
      # if the corresponding metrics show it to be bad enough not to retain
      trained_model:
        type: "@django.BinaryField"
        options:
          "null": true
          editable: true

  metrics:
    class: Metrics
    id_fields: [timestamp, definition_id]
    key: validation
    roles:
      edit: [scheduler]
      view: [scheduler, predicter]
    fields:
      timestamp: 
        type: "@django.ForeignKey"
        relation: training_event
        options:
          "null": false
          editable: false
          on_delete: "@django.PROTECT"
      definition_id: 
        type: "@django.ForeignKey"
        relation: training_event
        options:
          "null": false
          editable: false
          on_delete: "@django.PROTECT"
      metric:
        type: "@django.TextField"
        options:
          "null": false
          editable: yes
      value:
        type: "@django.FloatField"
        options:
          "null": false
          editable: true

  resources:
    class: Resources
    id_fields: [resource_group, machine_name]
    key: resource
    roles:
      edit: [scheduler]
      view: [scheduler, predicter]
    fields:
      resources_group: 
        type: "@django.ForeignKey"
        relation: training_event
        options:
          "null": false
          editable: false
          on_delete: "@django.PROTECT"
      machine_name:
        type: "@django.TextField"
        options:
          "null": false
          editable: true
      duration:
        type: "@django.FloatField"
        options:
          "null": true
          editable: true
      cost:
        type: "@django.FloatField"
        options:
          "null": true
          editable: true
      # Leave room for ad hoc details
      details:
        type: "@django.TextField"
        options:
          "null": true
          editable: true


  data_sources:
    class: DataSource
    id_fields: [data_source]
    key: data_source
    roles:
      edit: [scheduler]
      view: [scheduler, predicter]
    fields:
      data_source:
        type: "@django.ForeignKey"
        relation: training_event
        options:
          "null": false
          editable: false
          on_delete: "@django.PROTECT"
      zimagi_module:
        type: "@django.TextField"
        options:
          "null": false
          editable: true
      command:
        type: "@django.TextField"
        options:
          "null": false
          editable: true
      comment:
        type: "@django.TextField"
        options:
          "null": true
          editable: true


  model_config:
    class: ModelConfig
    id_fields: [definition_id]
    key: definition_id
    roles:
      edit: [scheduler, predicter]
      view: [scheduler, predicter]
    fields:
      # A UUID or similar unique identifier with no inherent meaning
      definition_id:
        type: "@django.UUIDField"
        options:
          "null": false
          editable: false
      # A library such as sklearn, keras, pytorch, etc.
      # TODO: Create a foreign table to enumerate this list
      library_name:
        type: "@django.ForeignKey"
        relation: library_names
        options:
          "null": false
          editable: false
          on_delete: "@django.PROTECT"
      # A general kind of model such as 'linear_model.LinearRegression' or
      # 'ensemble.HistGradientBoostingClassifier'
      model_type:
        type: "@django.CharField"
        options:
          "null": false
          editable: false
      # Hyperparameters or additional code/config needed to create an
      # untrained model object
      config_id:
        type: "@django.ForeignKey"
        relation: hyperparameters
        options:
          "null": true
          editable: false
          on_delete: "@django.PROTECT"


  hyperparameters:
    class: HyperParameters
    id_fields: [config_id, sequence]
    key: config
    roles:
      edit: [scheduler, predicter]
      view: [scheduler, predicter]
    fields:
      config_id:
        type: "@django.UUIDField"
        options:
          "null": false
          editable: false
      # Multiple hyperparameters configured under same config_id,
      # distinguished by distinct sequence number (generally ordinal, monotonic)
      sequence:
        type: "@django.PositiveSmallIntegerField"
        options:
          "null": false
          editable: true
      # This will act as a non-enforced foreign key in that values MAY
      # correspond to keys in `pseudokeys` but do not need to for standard
      # hyperparameters provided by the libraries
      key:
        type: "@django.TextField"
        options:
          "null": false
          editable: true
      # For pseudo-keys this will generally be NULL
      value:
        type: "@django.TextField"
        options:
          "null": true
          editable: true
          default: null
      # Hyperparamater values stored as strings, can be cast to other types
      value_type:
        type: "@django.TextField"
        options:
          "null": true
          editable: true
          default: null
      # Optionally, can include actual untrained-model setup code rather than
      # use a list of hyperparameters.  For NN libs this is probably easier
      manual_code:
        type: "@django.TextField"
        options:
          "null": true
          editable: true
          default: null


  library_names:
    class: LibraryNames
    id_fields: [library_name]
    key: library_name
    roles:
      edit: [scheduler]
      view: [scheduler, predicter]
    fields:
      library_name:
        type: "@django.TextField"
        options:
          "null": true
          editable: true


  model_type:
    class: ModelType
    id_fields: [model_type]
    key: model_type
    roles:
      edit: [scheduler, predicter]
      view: [scheduler, predicter]
    fields:
      model_type:
        type: "@django.TextField"
        options:
          "null": false
          editable: true


  pseudokeys:
    class: PseudoKeys
    id_fields: [pseudokey]
    key: pseudo_key
    roles:
      edit: [scheduler, predicter]
      view: [scheduler, predicter]
    fields:
      pseudokey:
        type: "@django.TextField"
        options:
          "null": false
          editable: true
      serialization:
        type: "@django.BinaryField"
        options:
          "null": true
          editable: true
         
